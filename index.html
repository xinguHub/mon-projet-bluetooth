<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Slider ESP32 BLE</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 2em;
    }
    input[type=range] {
      width: 80%;
    }
    button {
      font-size: 1.2em;
      margin: 1em;
      padding: 0.5em 1.2em;
      border-radius: 8px;
    }
    #status {
      margin-top: 1em;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>ContrÃ´le ESP32 - Slider</h1>

  <button onclick="connect()">ðŸ”Œ Connecter ESP32</button>

  <p>Valeur : <span id="sliderValue">250</span></p>
  <input type="range" id="slider" min="250" max="5000" step="1" value="250" oninput="updateValue(this.value)" onchange="sendSliderValue(this.value)">

  <p id="status">Ã‰tat : DÃ©connectÃ©</p>

<script>
let device, characteristic;

async function connect() {
  try {
    device = await navigator.bluetooth.requestDevice({
      filters: [{ services: ['12345678-1234-1234-1234-123456789abc'] }]
    });
    const server = await device.gatt.connect();
    const service = await server.getPrimaryService('12345678-1234-1234-1234-123456789abc');
    characteristic = await service.getCharacteristic('abcd1234-1a2b-3c4d-5e6f-abcdef123456');
    document.getElementById("status").textContent = "Ã‰tat : ConnectÃ© Ã  ESP32 âœ…";
  } catch (error) {
    alert("Erreur de connexion : " + error);
  }
}

function updateValue(val) {
  document.getElementById("sliderValue").textContent = val;
}

async function sendSliderValue(val) {
  if (!characteristic) {
    alert("Veuillez vous connecter d'abord.");
    return;
  }
  try {
    const encoder = new TextEncoder();
    const data = encoder.encode(val.toString());
    await characteristic.writeValue(data);
    document.getElementById("status").textContent = "Valeur envoyÃ©e : " + val;
  } catch (error) {
    alert("Erreur Ã  l'envoi : " + error);
  }
}
</script>

</body>
</html>
